<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Energy Consumption Insights Dashboard (2018–2024)</title>
  <link rel="icon" href="assets/logo.svg" />
  <!-- Unusual, handwritten-style + quirky fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@600;700&family=Patrick+Hand:wght@400&family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg1: #0f172a;  /* slate-900 */
      --bg2: #1e293b;  /* slate-800 */
      --accent: #22d3ee; /* cyan-400 */
      --accent2: #a78bfa; /* violet-400 */
      --card: rgba(255,255,255,0.06);
      --card-border: rgba(255,255,255,0.18);
      --ink: #e2e8f0;
      --ink-dim: #b6c2d9;
    }
    html, body {
      height: 100%;
    }
    body {
      margin: 0;
      color: var(--ink);
      background: radial-gradient(1200px 800px at 10% 10%, #10172a 0%, var(--bg1) 45%, var(--bg2) 100%);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
    }
    header {
      display: flex; align-items: center; gap: 12px;
      padding: 20px 24px 6px;
    }
    header img { width: 28px; height: 28px; }
    header h1 {
      margin: 0;
      font-family: "Patrick Hand", Inter, sans-serif;
      letter-spacing: 0.4px;
      font-size: 28px;
    }
    .wrap {
      max-width: 1080px; margin: 0 auto; padding: 18px 18px 8px;
    }
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      border: 1px solid var(--card-border);
      backdrop-filter: blur(6px);
      border-radius: 18px;
      padding: 18px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.35);
    }
    .meta {
      display: grid; grid-template-columns: 1fr auto; gap: 12px; align-items: end;
      padding: 8px 2px 4px;
    }
    .meta h2 {
      margin: 0;
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 0.2px;
      color: var(--ink);
    }
    .hint {
      font-family: "Caveat", cursive;
      font-size: 16px;
      color: var(--ink-dim);
    }
    .flex {
      display: grid; grid-template-columns: 1fr; gap: 16px;
    }
    .legend-note {
      font-size: 12px; color: var(--ink-dim); margin-top: 6px;
    }
    canvas {
      width: 100% !important; height: 520px !important;
      border-radius: 16px;
      /* Canvas gradient via CSS + we’ll overlay a drawn gradient too */
      background: radial-gradient(800px 500px at 80% -20%, rgba(167,139,250,0.18), rgba(34,211,238,0.10) 35%, transparent 65%);
    }
    footer {
      max-width: 1080px; margin: 12px auto 36px; padding: 0 18px;
      color: var(--ink-dim); font-size: 12px;
    }
    footer .source { margin-top: 6px; }
    .badges {
      display: flex; gap: 8px; flex-wrap: wrap; margin: 10px 0 2px;
    }
    .badge {
      border: 1px solid var(--card-border);
      background: var(--card);
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: var(--ink);
    }
    @media (min-width: 900px) {
      .flex { grid-template-columns: 1.1fr 0.9fr; }
    }
  </style>
</head>
<body>
  <header>
    <img src="assets/logo.svg" alt="logo" />
    <h1>Energy Consumption Insights Dashboard (2018–2024)</h1>
    <nav style="margin-left:auto; display:flex; gap:8px;">
        <a href="./sector.html"
           style="color:#a78bfa;text-decoration:none;border:1px solid rgba(255,255,255,0.18);
           padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.06)">
           View Radar by Region →
        </a>
        <button id="savePngBars"
           style="color:#a78bfa;border:1px solid rgba(255,255,255,0.18);
           padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.06);
           cursor:pointer">
           Download PNG
        </button>
      </nav>
    
  </header>

  <div class="wrap">
    <div class="card">
      <div class="meta">
        <h2>Global Electricity Consumption by Sector (Stacked) + Total (Line, Dual Axis)</h2>
        <div class="hint">note: annotations mark COVID dip & 2022 price shock</div>
      </div>

      <div class="badges">
        <div class="badge">Stacked Bars (Residential/Commercial/Industrial)</div>
        <div class="badge">Dual-axis Total Line</div>
        <div class="badge">Unusual Fonts</div>
        <div class="badge">Page & Canvas Gradients</div>
        <div class="badge">Inline Callout Annotations</div>
        <div class="badge">Dataset ↔ Config separation</div>
      </div>

      <div class="flex">
        <div>
          <canvas id="energyChart"></canvas>
          <div class="legend-note">Tip: Hover bars for sector values; hover line for total.</div>
        </div>
        <div class="card" style="padding:14px">
          <h3 style="margin:6px 0 8px;font-size:16px">Highlights & Justification</h3>
          <ul style="margin:0 0 8px 18px; line-height:1.35; font-size:13px">
            <li><strong>a.</strong> Multi-series combo: stacked bars (3 sectors) + total as a line on a second axis.</li>
            <li><strong>b.</strong> Multiple dimensions: sector, year, total, and derived YoY changes (tooltips).</li>
            <li><strong>e.</strong> Unusual fonts applied to labels & body (Caveat/Patrick Hand).</li>
            <li><strong>g.</strong> Extra visual complexity via page & canvas gradients, glassmorphism, and callouts.</li>
            <li><strong>j.</strong> Extra annotations: COVID-19 dip (2020) & energy shock (2022).</li>
          </ul>
          <p style="margin:10px 0 0; font-size:12px;color:var(--ink-dim)">
            This dashboard is self-contained, no build tool required. Data is defined as CSV text and parsed in-page, then referenced by the chart config.
          </p>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <div>© 2025 Energy Dashboard — by Balraj Dhawan</div>
    <div class="source">
      <strong>Source:</strong> IEA & World Bank consolidated indicators (illustrative, compiled for demo), 2018–2024.  
      Method: sectoral split approximations with realistic scaling; totals shown on secondary axis; annotations mark macro events.
    </div>
  </footer>

  <!-- Chart.js (bundled) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.6/dist/chart.umd.min.js" integrity="" crossorigin="anonymous"></script>

  <script>
    /* =========================
       1) DATASET (CSV STRINGS)
       ========================= */
    const energyCsv = `year,residential_gwh,commercial_gwh,industrial_gwh,total_gwh
2018,980,1240,1880,4100
2019,1020,1285,1935,4240
2020,990,1200,1760,3950
2021,1060,1330,1985,4375
2022,1085,1345,2050,4480
2023,1115,1390,2110,4615
2024,1150,1440,2190,4780`;

    const metadataCsv = `field,value
title,Global Electricity Consumption by Sector (2018–2024)
units,GWh
notes,"Totals may not equal sum due to rounding; 2020 dip reflects COVID demand contraction; 2022 reflects price shock."`;

    // Minimal CSV parser (no external deps)
    function parseCsv(text) {
      const [headerLine, ...lines] = text.trim().split(/\r?\n/);
      const headers = headerLine.split(",").map(s => s.trim());
      return lines.map(line => {
        const cols = line.split(",").map(s => s.trim());
        const obj = {};
        headers.forEach((h, i) => {
          const num = Number(cols[i]);
          obj[h] = isNaN(num) ? cols[i] : num;
        });
        return obj;
      });
    }

    const rows = parseCsv(energyCsv);
    // derive arrays from dataset (separation of concerns)
    const labels = rows.map(r => r.year);
    const resi = rows.map(r => r.residential_gwh);
    const comm = rows.map(r => r.commercial_gwh);
    const ind  = rows.map(r => r.industrial_gwh);
    const total = rows.map(r => r.total_gwh);

    /* =========================
       2) CHART CONFIG
       ========================= */
    const ctx = document.getElementById('energyChart').getContext('2d');

    // Canvas gradient (complements the page gradient)
    const gradBar = ctx.createLinearGradient(0, 0, 0, 520);
    gradBar.addColorStop(0, 'rgba(167,139,250,0.9)');   // violet-ish
    gradBar.addColorStop(1, 'rgba(167,139,250,0.3)');
    const gradBar2 = ctx.createLinearGradient(0, 0, 0, 520);
    gradBar2.addColorStop(0, 'rgba(34,211,238,0.9)');   // cyan-ish
    gradBar2.addColorStop(1, 'rgba(34,211,238,0.3)');
    const gradBar3 = ctx.createLinearGradient(0, 0, 0, 520);
    gradBar3.addColorStop(0, 'rgba(244,114,182,0.9)');  // pink-ish
    gradBar3.addColorStop(1, 'rgba(244,114,182,0.3)');
    const gradLine = ctx.createLinearGradient(0, 0, 0, 520);
    gradLine.addColorStop(0, 'rgba(255,255,255,0.95)');
    gradLine.addColorStop(1, 'rgba(255,255,255,0.4)');

    // helper for nice tooltip formatting
    const fmt = new Intl.NumberFormat('en-IN');

    const energyChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels,
        datasets: [
          {
            type: 'bar',
            label: 'Residential (GWh)',
            data: resi,
            backgroundColor: gradBar,
            borderRadius: 8,
            stack: 'S1'
          },
          {
            type: 'bar',
            label: 'Commercial (GWh)',
            data: comm,
            backgroundColor: gradBar2,
            borderRadius: 8,
            stack: 'S1'
          },
          {
            type: 'bar',
            label: 'Industrial (GWh)',
            data: ind,
            backgroundColor: gradBar3,
            borderRadius: 8,
            stack: 'S1'
          },
          {
            type: 'line',
            label: 'Total (GWh, right axis)',
            data: total,
            yAxisID: 'y2',
            tension: 0.25,
            fill: false,
            borderColor: gradLine,
            pointRadius: 4,
            pointHoverRadius: 6,
            borderWidth: 3
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        layout: { padding: 10 },
        plugins: {
          legend: {
            labels: {
              font: { family: 'Patrick Hand', size: 13 },
              color: '#e5e7eb'
            }
          },
          tooltip: {
            backgroundColor: 'rgba(15,23,42,0.95)',
            titleColor: '#e5e7eb',
            bodyColor: '#cbd5e1',
            callbacks: {
              label: (ctx) => {
                const v = ctx.parsed.y ?? ctx.raw;
                return ` ${ctx.dataset.label}: ${fmt.format(v)} GWh`;
              }
            }
          }
        },
        scales: {
          x: {
            stacked: true,
            ticks: {
              font: { family: 'Caveat', size: 16 },
              color: '#cbd5e1'
            },
            grid: { color: 'rgba(255,255,255,0.06)' }
          },
          y: {
            stacked: true,
            title: {
              display: true,
              text: 'Sectoral Consumption (GWh)',
              color: '#cbd5e1',
              font: { family: 'Patrick Hand', size: 14 }
            },
            ticks: {
              color: '#b6c2d9',
              callback: v => fmt.format(v)
            },
            grid: { color: 'rgba(255,255,255,0.06)' }
          },
          y2: {
            position: 'right',
            title: {
              display: true,
              text: 'Total (GWh)',
              color: '#cbd5e1',
              font: { family: 'Patrick Hand', size: 14 }
            },
            ticks: {
              color: '#b6c2d9',
              callback: v => fmt.format(v)
            },
            grid: { drawOnChartArea: false }
          }
        },
        // Inline annotations without external plugins
        animation: {
          onComplete: (anim) => {
            const {ctx, chartArea:{left, right, top, bottom}} = anim.chart;
            ctx.save();
            ctx.font = '700 16px "Caveat", cursive';
            ctx.fillStyle = 'rgba(255,255,255,0.95)';
            // COVID dip at 2020
            const idx2020 = labels.indexOf(2020);
            if (idx2020 >= 0) {
              const meta = anim.chart.getDatasetMeta(3); // total line
              const pt = meta.data[idx2020];
              if (pt) {
                ctx.beginPath();
                ctx.moveTo(pt.x+6, pt.y-6);
                ctx.lineTo(pt.x+80, pt.y-48);
                ctx.strokeStyle = 'rgba(255,255,255,0.5)';
                ctx.lineWidth = 1.5;
                ctx.stroke();
                ctx.fillText('COVID-19 demand dip', pt.x+84, pt.y-52);
              }
            }
            
            // 2022 price shock
            const idx2022 = labels.indexOf(2022);
            if (idx2022 >= 0) {
              const meta = anim.chart.getDatasetMeta(3);
              const pt = meta.data[idx2022];
              if (pt) {
                ctx.beginPath();
                ctx.moveTo(pt.x-6, pt.y-6);
                ctx.lineTo(pt.x-140, pt.y-60);
                ctx.strokeStyle = 'rgba(255,255,255,0.5)';
                ctx.lineWidth = 1.5;
                ctx.stroke();
                ctx.fillText('Energy price shock', pt.x-226, pt.y-64);
              }
            }
            ctx.restore();
          }
        }
      }
    });
  </script>
  <script>
    // PNG export for stacked bars + line chart
    document.getElementById('savePngBars').addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = 'energy-consumption-2018-2024.png';
      link.href = energyChart.canvas.toDataURL('image/png', 1.0);
      link.click();
    });
  </script>
  
</body>
</html>
